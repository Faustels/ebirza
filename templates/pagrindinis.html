<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link rel="stylesheet" type="text/css"    href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css"></link>
<link rel="stylesheet" href="/static/css/style.css">
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
<title>Puslapis</title>
</head>

<body class="d-flex flex-column min-vh-100">
{% include "inserts/common/assistant.html" %}
{% include "inserts/common/navigation.html" %}

<div class="row">
    <div class="col-8 centered">
        <h3>Kiti pasiūlymai</h3>
        <div class="row">
            <div class="col-6">
                <label for="maxPrice" class="form-label" id="priceLabel">Maksimali kaina: 0.2 €/kWh</label>
                <input style="width:100%" type="range" class="form-range" min="0" max="1" step="0.001" id="maxPrice" value="0.2" oninput="updatePrice()" onchange="updateTable()">
            </div>
            <div class="col-6">
                <label for="maxAmount" class="form-label" id="amountLabel">Maksimalus kiekis: 20 kWh</label>
                <input style="width:100%" type="range" class="form-range" min="1" max="1000" step="1" id="maxAmount" value = "20" oninput="updateAmount()" onchange="updateTable()">
            </div>
        </div>
        <table id="offerDataTable" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th class="th-sm">Pardavėjas
                    </th>
                    <th class="th-sm">Kaina (€/kWh)
                    </th>
                    <th class="th-sm">Kiekis (kWh)
                    </th>
                    <th class="th-sm">
                    </th>
                </tr>
            </thead>
            <tbody id="offerData">
                <tr>
                    <td>Petriukas</td>
                    <td>10</td>
                    <td>5</td>
                    <td class="buyButton">Pirkti</td>
                </tr>
                <tr>
                    <td>Aldona</td>
                    <td>100</td>
                    <td>50000</td>
                    <td class="buyButton">Pirkti</td>
                </tr>
                <tr>
                    <td>Antanas</td>
                    <td>40</td>
                    <td>1</td>
                    <td class="buyButton">Pirkti</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col-4 centered"">
        <h3>Mano duomenys</h3>
        <div id="map" style="width: 400px; height: 300px; margin:auto; z-index:-1;" ></div>
        <h4>Naudojimas</h4>
        <div class="progress w-50" style="margin:auto">
            <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
        </div>
        <h4>Gaminimas</h4>
        5 kWh
    </div>
</div>

{% include "inserts/common/footer.html" %}

</body>
{% include "inserts/common/scripts.html" %}
<script>
    let lat = {{ user.latitude }};
    let lon = {{ user.longitude }};
    var map = L.map('map', {
        maxBounds: [
            [53.559,20.965],
            [56.659,27.117]
        ],
    }).setView([lat, lon], 13);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 16,
        minZoom: 6.45,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);
    var marker = L.marker([lat, lon]).addTo(map);
    $(document).ready(function () {
        $('#offerDataTable').DataTable( {
        "language": {
            "lengthMenu": "Rodyti _MENU_ pardavėjų viename puslapyje",
            "zeroRecords": "Nieko nerasta",
            "info": "Rodomas puslapis _PAGE_ iš _PAGES_",
            "infoEmpty": "Nieko nerasta",
            "sSearch":        "Ieškoti:",
            "oPaginate": {
                "sFirst":    "Pirmas",
                "sLast":    "Paskutinis",
                "sNext":    "Kitas",
                "sPrevious": "Ankstesnis"
            },
            "infoFiltered": "(Filtruota iš _MAX_ įrašų)"
        }
    });
        $('.dataTables_length').addClass('bs-select');
    });

    var priceInput = $("#maxPrice")[0];
    var amountInput = $("#maxAmount")[0];

    var priceLabel = $("#priceLabel")[0];
    var amountLabel = $("#amountLabel")[0];

    var offerData = $("#offerData")[0];

    function updatePrice(){
        priceLabel.innerHTML = "Maksimali kaina: " + priceInput.value.toString() + " €/kWh";
    }

    function updateAmount(){
        amountLabel.innerHTML = "Maksimalus kiekis: " + amountInput.value.toString() + " kWh";
    }

    function updateTable() {
        offerData.innerHTML = ""
        fetch("/pagrindinis/getOffers?price=" + priceInput.value.toString() + "&amount=" + amountInput.value.toString(), { method:"GET" })
            .then(res => res.json())
            .then(response => {
                if (response[0] === null) {return}
                response.forEach((value) => {
                    temp = "<tr>\n";
                    temp += "<td>" + value["name"] + "</td>\n";
                    temp += "<td>" + value["price"].toString() + "</td>\n";
                    temp += "<td>" + value["amount"].toString() + "</td>\n";
                    temp += "<td class='buyButton'>Pirkti</td>"
                    temp += "</tr>\n"
                    offerData.innerHTML += temp;
                    });
                });
    }
</script>
</html>